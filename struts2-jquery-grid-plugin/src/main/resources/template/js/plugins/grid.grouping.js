// Grouping module
(function(a){a.jgrid.extend({groupingSetup:function(){return this.each(function(){var g=this,c=g.p.groupingView;if(c!==null&&((typeof c==="object")||a.isFunction(c))){if(!c.groupField.length){g.p.grouping=false}else{for(var e=0;e<c.groupField.length;e++){if(!c.groupOrder[e]){c.groupOrder[e]="asc"}if(!c.groupText[e]){c.groupText[e]="{0}"}if(typeof(c.groupColumnShow[e])!="boolean"){c.groupColumnShow[e]=true}if(typeof(c.groupSummary[e])!="boolean"){c.groupSummary[e]=false}if(c.groupColumnShow[e]===true){a(g).jqGrid("showCol",c.groupField[e])}else{a(g).jqGrid("hideCol",c.groupField[e])}c.sortitems[e]=[];c.sortnames[e]=[];c.summaryval[e]=[];if(c.groupSummary[e]){c.summary[e]=[];var b=g.p.colModel;for(var d=0,f=b.length;d<f;d++){if(b[d].summaryType){c.summary[e].push({nm:b[d].name,st:b[d].summaryType,v:""})}}}}g.p.scroll=false;g.p.rownumbers=false;g.p.subGrid=false;g.p.treeGrid=false;g.p.gridview=true}}else{g.p.grouping=false}})},groupingPrepare:function(d,c,e,b){this.each(function(){c[0]+="";var h=c[0].toString().split(" ").join("");var f=this.p.groupingView,g=this;if(e.hasOwnProperty(h)){e[h].push(d)}else{e[h]=[];e[h].push(d);f.sortitems[0].push(h);f.sortnames[0].push(a.trim(c[0].toString()));f.summaryval[0][h]=a.extend(true,[],f.summary[0])}if(f.groupSummary[0]){a.each(f.summaryval[0][h],function(j,k){if(a.isFunction(this.st)){this.v=this.st.call(g,this.v,this.nm,b)}else{this.v=a(g).jqGrid("groupingCalculations."+this.st,this.v,this.nm,b)}})}});return e},groupingToggle:function(b){this.each(function(){var i=this,c=i.p.groupingView,g=b.lastIndexOf("_"),e=b.substring(0,g+1),d=parseInt(b.substring(g+1),10)+1,f=c.minusicon,h=c.plusicon;if(a("#"+b+" span").hasClass(f)){if(c.showSummaryOnHide&&c.groupSummary[0]){a("#"+b).nextUntil(".jqfoot").hide()}else{a("#"+b).nextUntil("#"+e+String(d)).hide()}a("#"+b+" span").removeClass(f).addClass(h)}else{a("#"+b).nextUntil("#"+e+String(d)).show();a("#"+b+" span").removeClass(h).addClass(f)}});return false},groupingRender:function(b,c){return this.each(function(){var e=this,k=e.p.groupingView,g="",i="",j,f="",d,h,l;if(!k.groupDataSorted){k.sortitems[0].sort();k.sortnames[0].sort();if(k.groupOrder[0].toLowerCase()=="desc"){k.sortitems[0].reverse();k.sortnames[0].reverse()}}if(k.groupCollapse){f=k.plusicon}else{f=k.minusicon}f+=" tree-wrap-"+e.p.direction;l=0;while(l<c){if(e.p.colModel[l].name==k.groupField[0]){h=l;break}l++}a.each(k.sortitems[0],function(r,p){j=e.p.id+"ghead_"+r;i="<span style='cursor:pointer;' class='ui-icon "+f+"' onclick=\"jQuery('#"+e.p.id+"').jqGrid('groupingToggle','"+j+"');return false;\"></span>";try{d=e.formatter(j,k.sortnames[0][r],h,k.sortitems[0])}catch(y){d=k.sortnames[0][r]}g+='<tr id="'+j+'" role="row" class= "ui-widget-content jqgroup ui-row-'+e.p.direction+'"><td colspan="'+c+'">'+i+a.jgrid.format(k.groupText[0],d,b[p].length)+"</td></tr>";for(var o=0;o<b[p].length;o++){g+=b[p][o].join("")}if(k.groupSummary[0]){var t="";if(k.groupCollapse&&!k.showSummaryOnHide){t=' style="display:none;"'}g+="<tr"+t+' role="row" class="ui-widget-content jqfoot ui-row-'+e.p.direction+'">';var s=k.summaryval[0][p],v=e.p.colModel,u,w=b[p].length;for(var q=0;q<c;q++){var m="<td "+e.formatCol(q,1,"")+">&#160;</td>",x="{0}";a.each(s,function(){if(this.nm==v[q].name){if(v[q].summaryTpl){x=v[q].summaryTpl}if(this.st=="avg"){if(this.v&&w>0){this.v=(this.v/w)}}try{u=e.formatter("",this.v,q,this)}catch(n){u=this.v}m="<td "+e.formatCol(q,1,"")+">"+a.jgrid.format(x,u)+"</td>";return false}});g+=m}g+="</tr>"}});a("#"+e.p.id+" tbody:first").append(g);g=null})},groupingGroupBy:function(c,b,d){return this.each(function(){var g=this;if(typeof(c)=="string"){c=[c]}var e=g.p.groupingView;g.p.grouping=true;for(var f=0;f<e.groupField.length;f++){if(!e.groupColumnShow[f]){a(g).jqGrid("showCol",e.groupField[f])}}g.p.groupingView=a.extend(g.p.groupingView,b||{});e.groupField=c;a(g).trigger("reloadGrid")})},groupingRemove:function(b){return this.each(function(){var c=this;if(typeof(b)=="undefined"){b=true}c.p.grouping=false;if(b===true){a("tr.jqgroup, tr.jqfoot","#"+c.p.id+" tbody:first").remove();a("tr.jqgrow:hidden","#"+c.p.id+" tbody:first").show()}else{a(c).trigger("reloadGrid")}})},groupingCalculations:{sum:function(b,d,c){return parseFloat(b||0)+parseFloat((c[d]||0))},min:function(b,d,c){if(b===""){return parseFloat(c[d]||0)}return Math.min(parseFloat(b),parseFloat(c[d]||0))},max:function(b,d,c){if(b===""){return parseFloat(c[d]||0)}return Math.max(parseFloat(b),parseFloat(c[d]||0))},count:function(b,d,c){if(b===""){b=0}if(c.hasOwnProperty(d)){return b+1}else{return 0}},avg:function(b,d,c){return parseFloat(b||0)+parseFloat((c[d]||0))}}})})(jQuery);