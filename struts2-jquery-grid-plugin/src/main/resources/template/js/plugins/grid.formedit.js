/**
 * jqGrid extension for form editing Grid Data
 * Tony Tomov tony@trirand.com
 * http://trirand.com/blog/
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl-2.0.html
**/
(function(a){a.jgrid.extend({searchGrid:function(b){b=a.extend({recreateFilter:false,drag:true,sField:"searchField",sValue:"searchString",sOper:"searchOper",sFilter:"filters",loadDefaults:true,beforeShowSearch:null,afterShowSearch:null,onInitializeSearch:null,afterRedraw:null,closeAfterSearch:false,closeAfterReset:false,closeOnEscape:false,multipleSearch:false,multipleGroup:false,top:0,left:0,jqModal:true,modal:false,resize:false,width:450,height:"auto",dataheight:"auto",showQuery:false,errorcheck:true,sopt:null,stringResult:undefined,onClose:null,onSearch:null,onReset:null,toTop:true,overlay:10,columns:[],tmplNames:null,tmplFilters:null,tmplLabel:" Template: ",showOnLoad:false,layer:null},a.jgrid.search,b||{});return this.each(function(){var m=this;if(!m.grid){return}var g="fbox_"+m.p.id,h=true,d={themodal:"searchmod"+g,modalhead:"searchhd"+g,modalcontent:"searchcnt"+g,scrollelm:g},n=m.p.postData[b.sFilter];if(typeof(n)==="string"){n=a.jgrid.parse(n)}if(b.recreateFilter===true){a("#"+d.themodal).remove()}function e(){if(a.isFunction(b.beforeShowSearch)){h=b.beforeShowSearch(a("#"+g));if(typeof(h)==="undefined"){h=true}}if(h){a.jgrid.viewModal("#"+d.themodal,{gbox:"#gbox_"+g,jqm:b.jqModal,modal:b.modal,overlay:b.overlay,toTop:b.toTop});if(a.isFunction(b.afterShowSearch)){b.afterShowSearch(a("#"+g))}}}if(a("#"+d.themodal).html()!==null){e()}else{var r=a("<span><div id='"+g+"' class='searchFilter' style='overflow:auto'></div></span>").insertBefore("#gview_"+m.p.id);if(a.isFunction(b.onInitializeSearch)){b.onInitializeSearch(a("#"+g))}var j=a.extend([],m.p.colModel),f="<a href='javascript:void(0)' id='"+g+"_search' class='fm-button ui-state-default ui-corner-all fm-button-icon-right ui-reset'><span class='ui-icon ui-icon-search'></span>"+b.Find+"</a>",t="<a href='javascript:void(0)' id='"+g+"_reset' class='fm-button ui-state-default ui-corner-all fm-button-icon-left ui-search'><span class='ui-icon ui-icon-arrowreturnthick-1-w'></span>"+b.Reset+"</a>",l="",o="",q,s=false,p,c=-1;if(b.showQuery){l="<a href='javascript:void(0)' id='"+g+"_query' class='fm-button ui-state-default ui-corner-all fm-button-icon-left'><span class='ui-icon ui-icon-comment'></span>Query</a>"}if(!b.columns.length){a.each(j,function(v,y){if(!y.label){y.label=m.p.colNames[v]}if(!s){var u=(typeof y.search==="undefined")?true:y.search,x=(y.hidden===true),w=(y.searchoptions&&y.searchoptions.searchhidden===true);if((w&&u)||(u&&!x)){s=true;q=y.index||y.name;c=v}}})}else{j=b.columns}if((!n&&q)||b.multipleSearch===false){var k="eq";if(c>=0&&j[c].searchoptions&&j[c].searchoptions.sopt){k=j[c].searchoptions.sopt[0]}else{if(b.sopt&&b.sopt.length){k=b.sopt[0]}}n={groupOp:"AND",rules:[{field:q,op:k,data:""}]}}s=false;if(b.tmplNames&&b.tmplNames.length){s=true;o=b.tmplLabel;o+="<select class='ui-template'>";o+="<option value='default'>Default</option>";a.each(b.tmplNames,function(u,v){o+="<option value='"+u+"'>"+v+"</option>"});o+="</select>"}p="<table class='EditTable' style='border:0px none;margin-top:5px' id='"+g+"_2'><tbody><tr><td colspan='2'><hr class='ui-widget-content' style='margin:1px'/></td></tr><tr><td class='EditButton' style='text-align:left'>"+t+o+"</td><td class='EditButton'>"+l+f+"</td></tr></tbody></table>";a("#"+g).jqFilter({columns:j,filter:b.loadDefaults?n:null,showQuery:b.showQuery,errorcheck:b.errorcheck,sopt:b.sopt,groupButton:b.multipleGroup,ruleButtons:b.multipleSearch,afterRedraw:b.afterRedraw,_gridsopt:a.jgrid.search.odata,onChange:function(u){if(this.p.showQuery){a(".query",this).html(this.toUserFriendlyString())}}});r.append(p);if(s&&b.tmplFilters&&b.tmplFilters.length){a(".ui-template",r).bind("change",function(v){var u=a(this).val();if(u=="default"){a("#"+g).jqFilter("addFilter",n)}else{a("#"+g).jqFilter("addFilter",b.tmplFilters[parseInt(u,10)])}return false})}if(b.multipleGroup===true){b.multipleSearch=true}if(a.isFunction(b.onInitializeSearch)){b.onInitializeSearch(a("#"+g))}if(b.layer){a.jgrid.createModal(d,r,b,"#gview_"+m.p.id,a("#gbox_"+m.p.id)[0],"#"+b.layer,{position:"relative"})}else{a.jgrid.createModal(d,r,b,"#gview_"+m.p.id,a("#gbox_"+m.p.id)[0])}if(l){a("#"+g+"_query").bind("click",function(u){a(".queryresult",r).toggle();return false})}if(b.stringResult===undefined){b.stringResult=b.multipleSearch}a("#"+g+"_search").bind("click",function(){var x=a("#"+g),v={},u,w=x.jqFilter("filterData");if(b.errorcheck){x[0].hideError();if(!b.showQuery){x.jqFilter("toSQLString")}if(x[0].p.error){x[0].showError();return false}}if(b.stringResult){try{u=xmlJsonClass.toJson(w,"","",false)}catch(z){try{u=JSON.stringify(w)}catch(y){}}if(typeof(u)==="string"){v[b.sFilter]=u;a.each([b.sField,b.sValue,b.sOper],function(){v[this]=""})}}else{if(b.multipleSearch){v[b.sFilter]=w;a.each([b.sField,b.sValue,b.sOper],function(){v[this]=""})}else{v[b.sField]=w.rules[0].field;v[b.sValue]=w.rules[0].data;v[b.sOper]=w.rules[0].op;v[b.sFilter]=""}}m.p.search=true;a.extend(m.p.postData,v);if(a.isFunction(b.onSearch)){b.onSearch()}a(m).trigger("reloadGrid",[{page:1}]);if(b.closeAfterSearch){a.jgrid.hideModal("#"+d.themodal,{gb:"#gbox_"+m.p.id,jqm:b.jqModal,onClose:b.onClose})}return false});a("#"+g+"_reset").bind("click",function(){var u={},v=a("#"+g);m.p.search=false;if(b.multipleSearch===false){u[b.sField]=u[b.sValue]=u[b.sOper]=""}else{u[b.sFilter]=""}v[0].resetFilter();if(s){a(".ui-template",r).val("default")}a.extend(m.p.postData,u);if(a.isFunction(b.onReset)){b.onReset()}a(m).trigger("reloadGrid",[{page:1}]);return false});e();a(".fm-button:not(.ui-state-disabled)",r).hover(function(){a(this).addClass("ui-state-hover")},function(){a(this).removeClass("ui-state-hover")})}})},editGridRow:function(c,d){d=a.extend({top:0,left:0,width:300,height:"auto",dataheight:"auto",modal:false,overlay:10,drag:true,resize:true,url:null,mtype:"POST",clearAfterAdd:true,closeAfterEdit:false,reloadAfterSubmit:true,onInitializeForm:null,beforeInitData:null,beforeShowForm:null,afterShowForm:null,beforeSubmit:null,afterSubmit:null,onclickSubmit:null,afterComplete:null,onclickPgButtons:null,afterclickPgButtons:null,editData:{},recreateForm:false,jqModal:true,closeOnEscape:false,addedrow:"first",topinfo:"",bottominfo:"",saveicon:[],closeicon:[],savekey:[false,13],navkeys:[false,38,40],checkOnSubmit:false,checkOnUpdate:false,_savedData:{},processing:false,onClose:null,ajaxEditOptions:{},serializeEditData:null,viewPagerButtons:true},a.jgrid.edit,d||{});var b=d;return this.each(function(){var e=this;if(!e.grid||!c){return}var B=e.p.id,y="FrmGrid_"+B,v="TblGrid_"+B,j={themodal:"editmod"+B,modalhead:"edithd"+B,modalcontent:"editcnt"+B,scrollelm:y},C=a.isFunction(b.beforeShowForm)?b.beforeShowForm:false,M=a.isFunction(b.afterShowForm)?b.afterShowForm:false,L=a.isFunction(b.beforeInitData)?b.beforeInitData:false,p=a.isFunction(b.onInitializeForm)?b.onInitializeForm:false,G=null,X=true,H=1,r=0,D,P,F,A;if(c==="new"){c="_empty";d.caption=b.addCaption}else{d.caption=b.editCaption}if(d.recreateForm===true&&a("#"+j.themodal).html()!==null){a("#"+j.themodal).remove()}var m=true;if(d.checkOnUpdate&&d.jqModal&&!d.modal){m=false}function W(){a("#"+v+" > tbody > tr > td > .FormElement").each(function(ab){var ae=a(".customelement",this);if(ae.length){var ac=ae[0],Z=a(ac).attr("name");a.each(e.p.colModel,function(af,ah){if(this.name===Z&&this.editoptions&&a.isFunction(this.editoptions.custom_value)){try{D[Z]=this.editoptions.custom_value(a("#"+a.jgrid.jqID(Z),"#"+v),"get");if(D[Z]===undefined){throw"e1"}}catch(ag){if(ag==="e1"){a.jgrid.info_dialog(jQuery.jgrid.errors.errcap,"function 'custom_value' "+a.jgrid.edit.msg.novalue,jQuery.jgrid.edit.bClose)}else{a.jgrid.info_dialog(jQuery.jgrid.errors.errcap,ag.message,jQuery.jgrid.edit.bClose)}}return true}})}else{switch(a(this).get(0).type){case"checkbox":if(a(this).attr("checked")){D[this.name]=a(this).val()}else{var aa=a(this).attr("offval");D[this.name]=aa}break;case"select-one":D[this.name]=a("option:selected",this).val();P[this.name]=a("option:selected",this).text();break;case"select-multiple":D[this.name]=a(this).val();if(D[this.name]){D[this.name]=D[this.name].join(",")}else{D[this.name]=""}var ad=[];a("option:selected",this).each(function(af,ag){ad[af]=a(ag).text()});P[this.name]=ad.join(",");break;case"password":case"text":case"textarea":case"button":D[this.name]=a(this).val();break}if(e.p.autoencode){D[this.name]=a.jgrid.htmlEncode(D[this.name])}}});return true}function t(ab,ai,af,ad){var ap,aj,aa,ae=0,ah,ao,Z,al=[],ac=false,ak="<td class='CaptionTD'>&#160;</td><td class='DataTD'>&#160;</td>",an="",ag;for(ag=1;ag<=ad;ag++){an+=ak}if(ab!="_empty"){ac=a(ai).jqGrid("getInd",ab)}a(ai.p.colModel).each(function(at){ap=this.name;if(this.editrules&&this.editrules.edithidden===true){aj=false}else{aj=this.hidden===true?true:false}ao=aj?"style='display:none'":"";if(ap!=="cb"&&ap!=="subgrid"&&this.editable===true&&ap!=="rn"){if(ac===false){ah=""}else{if(ap==ai.p.ExpandColumn&&ai.p.treeGrid===true){ah=a("td:eq("+at+")",ai.rows[ac]).text()}else{try{ah=a.unformat(a("td:eq("+at+")",ai.rows[ac]),{rowId:ab,colModel:this},at)}catch(aq){ah=(this.edittype&&this.edittype=="textarea")?a("td:eq("+at+")",ai.rows[ac]).text():a("td:eq("+at+")",ai.rows[ac]).html()}if(!ah||ah=="&nbsp;"||ah=="&#160;"||(ah.length==1&&ah.charCodeAt(0)==160)){ah=""}}}var ar=a.extend({},this.editoptions||{},{id:ap,name:ap}),ax=a.extend({},{elmprefix:"",elmsuffix:"",rowabove:false,rowcontent:""},this.formoptions||{}),au=parseInt(ax.rowpos,10)||ae+1,aw=parseInt((parseInt(ax.colpos,10)||1)*2,10);if(ab=="_empty"&&ar.defaultValue){ah=a.isFunction(ar.defaultValue)?ar.defaultValue():ar.defaultValue}if(!this.edittype){this.edittype="text"}if(e.p.autoencode){ah=a.jgrid.htmlDecode(ah)}Z=a.jgrid.createEl(this.edittype,ar,ah,false,a.extend({},a.jgrid.ajaxOptions,ai.p.ajaxSelectOptions||{}));if(ah===""&&this.edittype=="checkbox"){ah=a(Z).attr("offval")}if(ah===""&&this.edittype=="select"){ah=a("option:eq(0)",Z).text()}if(b.checkOnSubmit||b.checkOnUpdate){b._savedData[ap]=ah}a(Z).addClass("FormElement");if(this.edittype=="text"||this.edittype=="textarea"){a(Z).addClass("ui-widget-content ui-corner-all")}aa=a(af).find("tr[rowpos="+au+"]");if(ax.rowabove){var av=a("<tr><td class='contentinfo' colspan='"+(ad*2)+"'>"+ax.rowcontent+"</td></tr>");a(af).append(av);av[0].rp=au}if(aa.length===0){aa=a("<tr "+ao+" rowpos='"+au+"'></tr>").addClass("FormData").attr("id","tr_"+ap);a(aa).append(an);a(af).append(aa);aa[0].rp=au}a("td:eq("+(aw-2)+")",aa[0]).html(typeof ax.label==="undefined"?ai.p.colNames[at]:ax.label);a("td:eq("+(aw-1)+")",aa[0]).append(ax.elmprefix).append(Z).append(ax.elmsuffix);al[ae]=at;ae++}});if(ae>0){var am=a("<tr class='FormData' style='display:none'><td class='CaptionTD'></td><td colspan='"+(ad*2-1)+"' class='DataTD'><input class='FormElement' id='id_g' type='text' name='"+ai.p.id+"_id' value='"+ab+"'/></td></tr>");am[0].rp=ae+999;a(af).append(am);if(b.checkOnSubmit||b.checkOnUpdate){b._savedData[ai.p.id+"_id"]=ab}}return al}function q(Z,ag,ac){var ak,ad=0,ah,af,aa,ae,ai;if(b.checkOnSubmit||b.checkOnUpdate){b._savedData={};b._savedData[ag.p.id+"_id"]=Z}var aj=ag.p.colModel;if(Z=="_empty"){a(aj).each(function(al){ak=this.name;aa=a.extend({},this.editoptions||{});af=a("#"+a.jgrid.jqID(ak),"#"+ac);if(af&&af.length&&af[0]!==null){ae="";if(aa.defaultValue){ae=a.isFunction(aa.defaultValue)?aa.defaultValue():aa.defaultValue;if(af[0].type=="checkbox"){ai=ae.toLowerCase();if(ai.search(/(false|0|no|off|undefined)/i)<0&&ai!==""){af[0].checked=true;af[0].defaultChecked=true;af[0].value=ae}else{af.attr({checked:"",defaultChecked:""})}}else{af.val(ae)}}else{if(af[0].type=="checkbox"){af[0].checked=false;af[0].defaultChecked=false;ae=a(af).attr("offval")}else{if(af[0].type&&af[0].type.substr(0,6)=="select"){af[0].selectedIndex=0}else{af.val(ae)}}}if(b.checkOnSubmit===true||b.checkOnUpdate){b._savedData[ak]=ae}}});a("#id_g","#"+ac).val(Z);return}var ab=a(ag).jqGrid("getInd",Z,true);if(!ab){return}a("td",ab).each(function(ao){ak=aj[ao].name;if(ak!=="cb"&&ak!=="subgrid"&&ak!=="rn"&&aj[ao].editable===true){if(ak==ag.p.ExpandColumn&&ag.p.treeGrid===true){ah=a(this).text()}else{try{ah=a.unformat(a(this),{rowId:Z,colModel:aj[ao]},ao)}catch(an){ah=aj[ao].edittype=="textarea"?a(this).text():a(this).html()}}if(e.p.autoencode){ah=a.jgrid.htmlDecode(ah)}if(b.checkOnSubmit===true||b.checkOnUpdate){b._savedData[ak]=ah}ak=a.jgrid.jqID(ak);switch(aj[ao].edittype){case"password":case"text":case"button":case"image":case"textarea":if(ah=="&nbsp;"||ah=="&#160;"||(ah.length==1&&ah.charCodeAt(0)==160)){ah=""}a("#"+ak,"#"+ac).val(ah);break;case"select":var am=ah.split(",");am=a.map(am,function(aq){return a.trim(aq)});a("#"+ak+" option","#"+ac).each(function(aq){if(!aj[ao].editoptions.multiple&&(am[0]==a.trim(a(this).text())||am[0]==a.trim(a(this).val()))){this.selected=true}else{if(aj[ao].editoptions.multiple){if(a.inArray(a.trim(a(this).text()),am)>-1||a.inArray(a.trim(a(this).val()),am)>-1){this.selected=true}else{this.selected=false}}else{this.selected=false}}});break;case"checkbox":ah=ah+"";if(aj[ao].editoptions&&aj[ao].editoptions.value){var al=aj[ao].editoptions.value.split(":");if(al[0]==ah){a("#"+ak,"#"+ac).attr("checked",true);a("#"+ak,"#"+ac).attr("defaultChecked",true)}else{a("#"+ak,"#"+ac).attr("checked",false);a("#"+ak,"#"+ac).attr("defaultChecked","")}}else{ah=ah.toLowerCase();if(ah.search(/(false|0|no|off|undefined)/i)<0&&ah!==""){a("#"+ak,"#"+ac).attr("checked",true);a("#"+ak,"#"+ac).attr("defaultChecked",true)}else{a("#"+ak,"#"+ac).attr("checked",false);a("#"+ak,"#"+ac).attr("defaultChecked","")}}break;case"custom":try{if(aj[ao].editoptions&&a.isFunction(aj[ao].editoptions.custom_value)){aj[ao].editoptions.custom_value(a("#"+ak,"#"+ac),"set",ah)}else{throw"e1"}}catch(ap){if(ap=="e1"){a.jgrid.info_dialog(jQuery.jgrid.errors.errcap,"function 'custom_value' "+a.jgrid.edit.msg.nodefined,jQuery.jgrid.edit.bClose)}else{a.jgrid.info_dialog(jQuery.jgrid.errors.errcap,ap.message,jQuery.jgrid.edit.bClose)}}break}ad++}});if(ad>0){a("#id_g","#"+v).val(Z)}}function k(){var ai,ah=[true,"",""],Z={},ad=e.p.prmNames,ag,ac,ak,ae;if(a.isFunction(b.beforeCheckValues)){var af=b.beforeCheckValues(D,a("#"+y),D[e.p.id+"_id"]=="_empty"?ad.addoper:ad.editoper);if(af&&typeof(af)==="object"){D=af}}for(ak in D){if(D.hasOwnProperty(ak)){ah=a.jgrid.checkValues(D[ak],ak,e);if(ah[0]===false){break}}}if(ah[0]){if(a.isFunction(b.onclickSubmit)){Z=b.onclickSubmit(b,D)||{}}if(a.isFunction(b.beforeSubmit)){ah=b.beforeSubmit(D,a("#"+y))}}if(ah[0]&&!b.processing){b.processing=true;a("#sData","#"+v+"_2").addClass("ui-state-active");ac=ad.oper;ag=ad.id;D[ac]=(a.trim(D[e.p.id+"_id"])=="_empty")?ad.addoper:ad.editoper;if(D[ac]!=ad.addoper){D[ag]=D[e.p.id+"_id"]}else{if(D[ag]===undefined){D[ag]=D[e.p.id+"_id"]}}delete D[e.p.id+"_id"];D=a.extend(D,b.editData,Z);if(e.p.treeGrid===true){if(D[ac]==ad.addoper){ae=a(e).jqGrid("getGridParam","selrow");var aa=e.p.treeGridModel=="adjacency"?e.p.treeReader.parent_id_field:"parent_id";D[aa]=ae}for(i in e.p.treeReader){var aj=e.p.treeReader[i];if(D.hasOwnProperty(aj)){if(D[ac]==ad.addoper&&i==="parent_id_field"){continue}delete D[aj]}}}var ab=a.extend({url:b.url?b.url:a(e).jqGrid("getGridParam","editurl"),type:b.mtype,data:a.isFunction(b.serializeEditData)?b.serializeEditData(D):D,complete:function(an,al){if(al!="success"){ah[0]=false;if(a.isFunction(b.errorTextFormat)){ah[1]=b.errorTextFormat(an)}else{ah[1]=al+" Status: '"+an.statusText+"'. Error code: "+an.status}}else{if(a.isFunction(b.afterSubmit)){ah=b.afterSubmit(an,D)}}if(ah[0]===false){a("#FormError>td","#"+v).html(ah[1]);a("#FormError","#"+v).show()}else{a.each(e.p.colModel,function(ap,ar){if(P[this.name]&&this.formatter&&this.formatter=="select"){try{delete P[this.name]}catch(aq){}}});D=a.extend(D,P);if(e.p.autoencode){a.each(D,function(aq,ap){D[aq]=a.jgrid.htmlDecode(ap)})}b.reloadAfterSubmit=b.reloadAfterSubmit&&e.p.datatype!="local";if(D[ac]==ad.addoper){if(!ah[2]){ah[2]=a.jgrid.randId()}D[ag]=ah[2];if(b.closeAfterAdd){if(b.reloadAfterSubmit){a(e).trigger("reloadGrid")}else{if(e.p.treeGrid===true){a(e).jqGrid("addChildNode",ah[2],ae,D)}else{a(e).jqGrid("addRowData",ah[2],D,d.addedrow);a(e).jqGrid("setSelection",ah[2])}}a.jgrid.hideModal("#"+j.themodal,{gb:"#gbox_"+B,jqm:d.jqModal,onClose:b.onClose})}else{if(b.clearAfterAdd){if(b.reloadAfterSubmit){a(e).trigger("reloadGrid")}else{if(e.p.treeGrid===true){a(e).jqGrid("addChildNode",ah[2],ae,D)}else{a(e).jqGrid("addRowData",ah[2],D,d.addedrow)}}q("_empty",e,y)}else{if(b.reloadAfterSubmit){a(e).trigger("reloadGrid")}else{if(e.p.treeGrid===true){a(e).jqGrid("addChildNode",ah[2],ae,D)}else{a(e).jqGrid("addRowData",ah[2],D,d.addedrow)}}}}}else{if(b.reloadAfterSubmit){a(e).trigger("reloadGrid");if(!b.closeAfterEdit){setTimeout(function(){a(e).jqGrid("setSelection",D[ag])},1000)}}else{if(e.p.treeGrid===true){a(e).jqGrid("setTreeRow",D[ag],D)}else{a(e).jqGrid("setRowData",D[ag],D)}}if(b.closeAfterEdit){a.jgrid.hideModal("#"+j.themodal,{gb:"#gbox_"+B,jqm:d.jqModal,onClose:b.onClose})}}if(a.isFunction(b.afterComplete)){ai=an;setTimeout(function(){b.afterComplete(ai,D,a("#"+y));ai=null},500)}if(b.checkOnSubmit||b.checkOnUpdate){a("#"+y).data("disabled",false);if(b._savedData[e.p.id+"_id"]!="_empty"){for(var am in b._savedData){if(D[am]){b._savedData[am]=D[am]}}}}}b.processing=false;a("#sData","#"+v+"_2").removeClass("ui-state-active");try{a(":input:visible","#"+y)[0].focus()}catch(ao){}}},a.jgrid.ajaxOptions,b.ajaxEditOptions);if(!ab.url&&!b.useDataProxy){if(a.isFunction(e.p.dataProxy)){b.useDataProxy=true}else{ah[0]=false;ah[1]+=" "+a.jgrid.errors.nourl}}if(ah[0]){if(b.useDataProxy){e.p.dataProxy.call(e,ab,"set_"+e.p.id)}else{a.ajax(ab)}}}if(ah[0]===false){a("#FormError>td","#"+v).html(ah[1]);a("#FormError","#"+v).show()}}function J(ac,Z){var aa=false,ab;for(ab in ac){if(ac[ab]!=Z[ab]){aa=true;break}}return aa}function T(){a.each(e.p.colModel,function(Z,aa){if(aa.editoptions&&aa.editoptions.NullIfEmpty===true){if(D.hasOwnProperty(aa.name)&&D[aa.name]==""){D[aa.name]="null"}}})}function g(){var Z=true;a("#FormError","#"+v).hide();if(b.checkOnUpdate){D={};P={};W();F=a.extend({},D,P);A=J(F,b._savedData);if(A){a("#"+y).data("disabled",true);a(".confirm","#"+j.themodal).show();Z=false}else{T()}}return Z}function V(){if(c!=="_empty"&&typeof(e.p.savedRow)!=="undefined"&&e.p.savedRow.length>0&&a.isFunction(a.fn.jqGrid.restoreRow)){for(var Z=0;Z<e.p.savedRow.length;Z++){if(e.p.savedRow[Z].id==c){a(e).jqGrid("restoreRow",c);break}}}}function I(Z,aa){if(Z===0){a("#pData","#"+v+"_2").addClass("ui-state-disabled")}else{a("#pData","#"+v+"_2").removeClass("ui-state-disabled")}if(Z==aa){a("#nData","#"+v+"_2").addClass("ui-state-disabled")}else{a("#nData","#"+v+"_2").removeClass("ui-state-disabled")}}function Y(){var aa=a(e).jqGrid("getDataIDs"),Z=a("#id_g","#"+v).val(),ab=a.inArray(Z,aa);return[ab,aa]}if(a("#"+j.themodal).html()!==null){if(L){X=L(a("#"+y));if(typeof(X)=="undefined"){X=true}}if(X===false){return}V();a(".ui-jqdialog-title","#"+j.modalhead).html(d.caption);a("#FormError","#"+v).hide();if(b.topinfo){a(".topinfo","#"+v+"_2").html(b.topinfo);a(".tinfo","#"+v+"_2").show()}else{a(".tinfo","#"+v+"_2").hide()}if(b.bottominfo){a(".bottominfo","#"+v+"_2").html(b.bottominfo);a(".binfo","#"+v+"_2").show()}else{a(".binfo","#"+v+"_2").hide()}q(c,e,y);if(c=="_empty"||!b.viewPagerButtons){a("#pData, #nData","#"+v+"_2").hide()}else{a("#pData, #nData","#"+v+"_2").show()}if(b.processing===true){b.processing=false;a("#sData","#"+v+"_2").removeClass("ui-state-active")}if(a("#"+y).data("disabled")===true){a(".confirm","#"+j.themodal).hide();a("#"+y).data("disabled",false)}if(C){C(a("#"+y))}a("#"+j.themodal).data("onClose",b.onClose);a.jgrid.viewModal("#"+j.themodal,{gbox:"#gbox_"+B,jqm:d.jqModal,jqM:false,overlay:d.overlay,modal:d.modal});if(!m){a(".jqmOverlay").click(function(){if(!g()){return false}a.jgrid.hideModal("#"+j.themodal,{gb:"#gbox_"+B,jqm:d.jqModal,onClose:b.onClose});return false})}if(M){M(a("#"+y))}}else{var s=isNaN(d.dataheight)?d.dataheight:d.dataheight+"px",S=a("<form name='FormPost' id='"+y+"' class='FormGrid' onSubmit='return false;' style='width:100%;overflow:auto;position:relative;height:"+s+";'></form>").data("disabled",false),z=a("<table id='"+v+"' class='EditTable' cellspacing='0' cellpadding='0' border='0'><tbody></tbody></table>");if(L){X=L(a("#"+y));if(typeof(X)=="undefined"){X=true}}if(X===false){return}V();a(e.p.colModel).each(function(Z){var aa=this.formoptions;H=Math.max(H,aa?aa.colpos||0:0);r=Math.max(r,aa?aa.rowpos||0:0)});a(S).append(z);var K=a("<tr id='FormError' style='display:none'><td class='ui-state-error' colspan='"+(H*2)+"'></td></tr>");K[0].rp=0;a(z).append(K);K=a("<tr style='display:none' class='tinfo'><td class='topinfo' colspan='"+(H*2)+"'>"+b.topinfo+"</td></tr>");K[0].rp=0;a(z).append(K);var f=e.p.direction=="rtl"?true:false,R=f?"nData":"pData",U=f?"pData":"nData";t(c,e,z,H);var l="<a href='javascript:void(0)' id='"+R+"' class='fm-button ui-state-default ui-corner-left'><span class='ui-icon ui-icon-triangle-1-w'></span></a>",n="<a href='javascript:void(0)' id='"+U+"' class='fm-button ui-state-default ui-corner-right'><span class='ui-icon ui-icon-triangle-1-e'></span></a>",h="<a href='javascript:void(0)' id='sData' class='fm-button ui-state-default ui-corner-all'>"+d.bSubmit+"</a>",u="<a href='javascript:void(0)' id='cData' class='fm-button ui-state-default ui-corner-all'>"+d.bCancel+"</a>";var O="<table border='0' cellspacing='0' cellpadding='0' class='EditTable' id='"+v+"_2'><tbody><tr><td colspan='2'><hr class='ui-widget-content' style='margin:1px'/></td></tr><tr id='Act_Buttons'><td class='navButton'>"+(f?n+l:l+n)+"</td><td class='EditButton'>"+h+u+"</td></tr>";O+="<tr style='display:none' class='binfo'><td class='bottominfo' colspan='2'>"+b.bottominfo+"</td></tr>";O+="</tbody></table>";if(r>0){var x=[];a.each(a(z)[0].rows,function(Z,aa){x[Z]=aa});x.sort(function(aa,Z){if(aa.rp>Z.rp){return 1}if(aa.rp<Z.rp){return -1}return 0});a.each(x,function(Z,aa){a("tbody",z).append(aa)})}d.gbox="#gbox_"+B;var o=false;if(d.closeOnEscape===true){d.closeOnEscape=false;o=true}var N=a("<span></span>").append(S).append(O);a.jgrid.createModal(j,N,d,"#gview_"+e.p.id,a("#gbox_"+e.p.id)[0]);if(f){a("#pData, #nData","#"+v+"_2").css("float","right");a(".EditButton","#"+v+"_2").css("text-align","left")}if(b.topinfo){a(".tinfo","#"+v+"_2").show()}if(b.bottominfo){a(".binfo","#"+v+"_2").show()}N=null;O=null;a("#"+j.themodal).keydown(function(Z){var aa=Z.target;if(a("#"+y).data("disabled")===true){return false}if(b.savekey[0]===true&&Z.which==b.savekey[1]){if(aa.tagName!="TEXTAREA"){a("#sData","#"+v+"_2").trigger("click");return false}}if(Z.which===27){if(!g()){return false}if(o){a.jgrid.hideModal(this,{gb:d.gbox,jqm:d.jqModal,onClose:b.onClose})}return false}if(b.navkeys[0]===true){if(a("#id_g","#"+v).val()=="_empty"){return true}if(Z.which==b.navkeys[1]){a("#pData","#"+v+"_2").trigger("click");return false}if(Z.which==b.navkeys[2]){a("#nData","#"+v+"_2").trigger("click");return false}}});if(d.checkOnUpdate){a("a.ui-jqdialog-titlebar-close span","#"+j.themodal).removeClass("jqmClose");a("a.ui-jqdialog-titlebar-close","#"+j.themodal).unbind("click").click(function(){if(!g()){return false}a.jgrid.hideModal("#"+j.themodal,{gb:"#gbox_"+B,jqm:d.jqModal,onClose:b.onClose});return false})}d.saveicon=a.extend([true,"left","ui-icon-disk"],d.saveicon);d.closeicon=a.extend([true,"left","ui-icon-close"],d.closeicon);if(d.saveicon[0]===true){a("#sData","#"+v+"_2").addClass(d.saveicon[1]=="right"?"fm-button-icon-right":"fm-button-icon-left").append("<span class='ui-icon "+d.saveicon[2]+"'></span>")}if(d.closeicon[0]===true){a("#cData","#"+v+"_2").addClass(d.closeicon[1]=="right"?"fm-button-icon-right":"fm-button-icon-left").append("<span class='ui-icon "+d.closeicon[2]+"'></span>")}if(b.checkOnSubmit||b.checkOnUpdate){h="<a href='javascript:void(0)' id='sNew' class='fm-button ui-state-default ui-corner-all' style='z-index:1002'>"+d.bYes+"</a>";n="<a href='javascript:void(0)' id='nNew' class='fm-button ui-state-default ui-corner-all' style='z-index:1002'>"+d.bNo+"</a>";u="<a href='javascript:void(0)' id='cNew' class='fm-button ui-state-default ui-corner-all' style='z-index:1002'>"+d.bExit+"</a>";var E,w=d.zIndex||999;w++;if(a.browser.msie&&a.browser.version==6){E='<iframe style="display:block;position:absolute;z-index:-1;filter:Alpha(Opacity=\'0\');" src="javascript:false;"></iframe>'}else{E=""}a("<div class='ui-widget-overlay jqgrid-overlay confirm' style='z-index:"+w+";display:none;'>&#160;"+E+"</div><div class='confirm ui-widget-content ui-jqconfirm' style='z-index:"+(w+1)+"'>"+d.saveData+"<br/><br/>"+h+n+u+"</div>").insertAfter("#"+y);a("#sNew","#"+j.themodal).click(function(){k();a("#"+y).data("disabled",false);a(".confirm","#"+j.themodal).hide();return false});a("#nNew","#"+j.themodal).click(function(){a(".confirm","#"+j.themodal).hide();a("#"+y).data("disabled",false);setTimeout(function(){a(":input","#"+y)[0].focus()},0);return false});a("#cNew","#"+j.themodal).click(function(){a(".confirm","#"+j.themodal).hide();a("#"+y).data("disabled",false);a.jgrid.hideModal("#"+j.themodal,{gb:"#gbox_"+B,jqm:d.jqModal,onClose:b.onClose});return false})}if(p){p(a("#"+y))}if(c=="_empty"||!b.viewPagerButtons){a("#pData,#nData","#"+v+"_2").hide()}else{a("#pData,#nData","#"+v+"_2").show()}if(C){C(a("#"+y))}a("#"+j.themodal).data("onClose",b.onClose);a.jgrid.viewModal("#"+j.themodal,{gbox:"#gbox_"+B,jqm:d.jqModal,overlay:d.overlay,modal:d.modal});if(!m){a(".jqmOverlay").click(function(){if(!g()){return false}a.jgrid.hideModal("#"+j.themodal,{gb:"#gbox_"+B,jqm:d.jqModal,onClose:b.onClose});return false})}if(M){M(a("#"+y))}a(".fm-button","#"+j.themodal).hover(function(){a(this).addClass("ui-state-hover")},function(){a(this).removeClass("ui-state-hover")});a("#sData","#"+v+"_2").click(function(Z){D={};P={};a("#FormError","#"+v).hide();W();T();if(D[e.p.id+"_id"]=="_empty"){k()}else{if(d.checkOnSubmit===true){F=a.extend({},D,P);A=J(F,b._savedData);if(A){a("#"+y).data("disabled",true);a(".confirm","#"+j.themodal).show()}else{k()}}else{k()}}return false});a("#cData","#"+v+"_2").click(function(Z){if(!g()){return false}a.jgrid.hideModal("#"+j.themodal,{gb:"#gbox_"+B,jqm:d.jqModal,onClose:b.onClose});return false});a("#nData","#"+v+"_2").click(function(Z){if(!g()){return false}a("#FormError","#"+v).hide();var aa=Y();aa[0]=parseInt(aa[0],10);if(aa[0]!=-1&&aa[1][aa[0]+1]){if(a.isFunction(d.onclickPgButtons)){d.onclickPgButtons("next",a("#"+y),aa[1][aa[0]])}q(aa[1][aa[0]+1],e,y);a(e).jqGrid("setSelection",aa[1][aa[0]+1]);if(a.isFunction(d.afterclickPgButtons)){d.afterclickPgButtons("next",a("#"+y),aa[1][aa[0]+1])}I(aa[0]+1,aa[1].length-1)}return false});a("#pData","#"+v+"_2").click(function(aa){if(!g()){return false}a("#FormError","#"+v).hide();var Z=Y();if(Z[0]!=-1&&Z[1][Z[0]-1]){if(a.isFunction(d.onclickPgButtons)){d.onclickPgButtons("prev",a("#"+y),Z[1][Z[0]])}q(Z[1][Z[0]-1],e,y);a(e).jqGrid("setSelection",Z[1][Z[0]-1]);if(a.isFunction(d.afterclickPgButtons)){d.afterclickPgButtons("prev",a("#"+y),Z[1][Z[0]-1])}I(Z[0]-1,Z[1].length-1)}return false})}var Q=Y();I(Q[0],Q[1].length-1)})},viewGridRow:function(b,c){c=a.extend({top:0,left:0,width:0,height:"auto",dataheight:"auto",modal:false,overlay:10,drag:true,resize:true,jqModal:true,closeOnEscape:false,labelswidth:"30%",closeicon:[],navkeys:[false,38,40],onClose:null,beforeShowForm:null,beforeInitData:null,viewPagerButtons:true},a.jgrid.view,c||{});return this.each(function(){var w=this;if(!w.grid||!b){return}if(!c.imgpath){c.imgpath=w.p.imgpath}var s=w.p.id,A="ViewGrid_"+s,t="ViewTbl_"+s,j={themodal:"viewmod"+s,modalhead:"viewhd"+s,modalcontent:"viewcnt"+s,scrollelm:A},z=a.isFunction(c.beforeInitData)?c.beforeInitData:false,m=true,g=1,f=0;function k(){if(c.closeOnEscape===true||c.navkeys[0]===true){setTimeout(function(){a(".ui-jqdialog-titlebar-close","#"+j.modalhead).focus()},0)}}function o(K,Q,O,W){var G,J,R,U=0,Z,aa,Y=[],P=false,L="<td class='CaptionTD form-view-label ui-widget-content' width='"+c.labelswidth+"'>&#160;</td><td class='DataTD form-view-data ui-helper-reset ui-widget-content'>&#160;</td>",N="",H="<td class='CaptionTD form-view-label ui-widget-content'>&#160;</td><td class='DataTD form-view-data ui-widget-content'>&#160;</td>",M=["integer","number","currency"],T=0,S=0,I,F,X;for(var V=1;V<=W;V++){N+=V==1?L:H}a(Q.p.colModel).each(function(ac){if(this.editrules&&this.editrules.edithidden===true){J=false}else{J=this.hidden===true?true:false}if(!J&&this.align==="right"){if(this.formatter&&a.inArray(this.formatter,M)!==-1){T=Math.max(T,parseInt(this.width,10))}else{S=Math.max(S,parseInt(this.width,10))}}});I=T!==0?T:S!==0?S:0;P=a(Q).jqGrid("getInd",K);a(Q.p.colModel).each(function(ad){G=this.name;F=false;if(this.editrules&&this.editrules.edithidden===true){J=false}else{J=this.hidden===true?true:false}aa=J?"style='display:none'":"";X=(typeof this.viewable!="boolean")?true:this.viewable;if(G!=="cb"&&G!=="subgrid"&&G!=="rn"&&X){if(P===false){Z=""}else{if(G==Q.p.ExpandColumn&&Q.p.treeGrid===true){Z=a("td:eq("+ad+")",Q.rows[P]).text()}else{Z=a("td:eq("+ad+")",Q.rows[P]).html()}}F=this.align==="right"&&I!==0?true:false;var ac=a.extend({},this.editoptions||{},{id:G,name:G}),ah=a.extend({},{rowabove:false,rowcontent:""},this.formoptions||{}),ae=parseInt(ah.rowpos,10)||U+1,ag=parseInt((parseInt(ah.colpos,10)||1)*2,10);if(ah.rowabove){var af=a("<tr><td class='contentinfo' colspan='"+(W*2)+"'>"+ah.rowcontent+"</td></tr>");a(O).append(af);af[0].rp=ae}R=a(O).find("tr[rowpos="+ae+"]");if(R.length===0){R=a("<tr "+aa+" rowpos='"+ae+"'></tr>").addClass("FormData").attr("id","trv_"+G);a(R).append(N);a(O).append(R);R[0].rp=ae}a("td:eq("+(ag-2)+")",R[0]).html("<b>"+(typeof ah.label==="undefined"?Q.p.colNames[ad]:ah.label)+"</b>");a("td:eq("+(ag-1)+")",R[0]).append("<span>"+Z+"</span>").attr("id","v_"+G);if(F){a("td:eq("+(ag-1)+") span",R[0]).css({"text-align":"right",width:I+"px"})}Y[U]=ad;U++}});if(U>0){var ab=a("<tr class='FormData' style='display:none'><td class='CaptionTD'></td><td colspan='"+(W*2-1)+"' class='DataTD'><input class='FormElement' id='id_g' type='text' name='id' value='"+K+"'/></td></tr>");ab[0].rp=U+99;a(O).append(ab)}return Y}function n(J,L){var F,M,I=0,H,G,K;K=a(L).jqGrid("getInd",J,true);if(!K){return}a("td",K).each(function(N){F=L.p.colModel[N].name;if(L.p.colModel[N].editrules&&L.p.colModel[N].editrules.edithidden===true){M=false}else{M=L.p.colModel[N].hidden===true?true:false}if(F!=="cb"&&F!=="subgrid"&&F!=="rn"){if(F==L.p.ExpandColumn&&L.p.treeGrid===true){H=a(this).text()}else{H=a(this).html()}G=a.extend({},L.p.colModel[N].editoptions||{});F=a.jgrid.jqID("v_"+F);a("#"+F+" span","#"+t).html(H);if(M){a("#"+F,"#"+t).parents("tr:first").hide()}I++}});if(I>0){a("#id_g","#"+t).val(J)}}function p(F,G){if(F===0){a("#pData","#"+t+"_2").addClass("ui-state-disabled")}else{a("#pData","#"+t+"_2").removeClass("ui-state-disabled")}if(F==G){a("#nData","#"+t+"_2").addClass("ui-state-disabled")}else{a("#nData","#"+t+"_2").removeClass("ui-state-disabled")}}function h(){var G=a(w).jqGrid("getDataIDs"),F=a("#id_g","#"+t).val(),H=a.inArray(F,G);return[H,G]}if(a("#"+j.themodal).html()!==null){if(z){m=z(a("#"+A));if(typeof(m)=="undefined"){m=true}}if(m===false){return}a(".ui-jqdialog-title","#"+j.modalhead).html(c.caption);a("#FormError","#"+t).hide();n(b,w);if(a.isFunction(c.beforeShowForm)){c.beforeShowForm(a("#"+A))}a.jgrid.viewModal("#"+j.themodal,{gbox:"#gbox_"+s,jqm:c.jqModal,jqM:false,overlay:c.overlay,modal:c.modal});k()}else{var y=isNaN(c.dataheight)?c.dataheight:c.dataheight+"px";var C=a("<form name='FormPost' id='"+A+"' class='FormGrid' style='width:100%;overflow:auto;position:relative;height:"+y+";'></form>"),l=a("<table id='"+t+"' class='EditTable' cellspacing='1' cellpadding='2' border='0' style='table-layout:fixed'><tbody></tbody></table>");if(z){m=z(a("#"+A));if(typeof(m)=="undefined"){m=true}}if(m===false){return}a(w.p.colModel).each(function(F){var G=this.formoptions;g=Math.max(g,G?G.colpos||0:0);f=Math.max(f,G?G.rowpos||0:0)});a(C).append(l);o(b,w,l,g);var x=w.p.direction=="rtl"?true:false,E=x?"nData":"pData",e=x?"pData":"nData",u="<a href='javascript:void(0)' id='"+E+"' class='fm-button ui-state-default ui-corner-left'><span class='ui-icon ui-icon-triangle-1-w'></span></a>",v="<a href='javascript:void(0)' id='"+e+"' class='fm-button ui-state-default ui-corner-right'><span class='ui-icon ui-icon-triangle-1-e'></span></a>",D="<a href='javascript:void(0)' id='cData' class='fm-button ui-state-default ui-corner-all'>"+c.bClose+"</a>";if(f>0){var d=[];a.each(a(l)[0].rows,function(F,G){d[F]=G});d.sort(function(G,F){if(G.rp>F.rp){return 1}if(G.rp<F.rp){return -1}return 0});a.each(d,function(F,G){a("tbody",l).append(G)})}c.gbox="#gbox_"+s;var r=false;if(c.closeOnEscape===true){c.closeOnEscape=false;r=true}var B=a("<span></span>").append(C).append("<table border='0' class='EditTable' id='"+t+"_2'><tbody><tr id='Act_Buttons'><td class='navButton' width='"+c.labelswidth+"'>"+(x?v+u:u+v)+"</td><td class='EditButton'>"+D+"</td></tr></tbody></table>");a.jgrid.createModal(j,B,c,"#gview_"+w.p.id,a("#gview_"+w.p.id)[0]);if(x){a("#pData, #nData","#"+t+"_2").css("float","right");a(".EditButton","#"+t+"_2").css("text-align","left")}if(!c.viewPagerButtons){a("#pData, #nData","#"+t+"_2").hide()}B=null;a("#"+j.themodal).keydown(function(F){if(F.which===27){if(r){a.jgrid.hideModal(this,{gb:c.gbox,jqm:c.jqModal,onClose:c.onClose})}return false}if(c.navkeys[0]===true){if(F.which===c.navkeys[1]){a("#pData","#"+t+"_2").trigger("click");return false}if(F.which===c.navkeys[2]){a("#nData","#"+t+"_2").trigger("click");return false}}});c.closeicon=a.extend([true,"left","ui-icon-close"],c.closeicon);if(c.closeicon[0]===true){a("#cData","#"+t+"_2").addClass(c.closeicon[1]=="right"?"fm-button-icon-right":"fm-button-icon-left").append("<span class='ui-icon "+c.closeicon[2]+"'></span>")}if(a.isFunction(c.beforeShowForm)){c.beforeShowForm(a("#"+A))}a.jgrid.viewModal("#"+j.themodal,{gbox:"#gbox_"+s,jqm:c.jqModal,modal:c.modal});a(".fm-button:not(.ui-state-disabled)","#"+t+"_2").hover(function(){a(this).addClass("ui-state-hover")},function(){a(this).removeClass("ui-state-hover")});k();a("#cData","#"+t+"_2").click(function(F){a.jgrid.hideModal("#"+j.themodal,{gb:"#gbox_"+s,jqm:c.jqModal,onClose:c.onClose});return false});a("#nData","#"+t+"_2").click(function(F){a("#FormError","#"+t).hide();var G=h();G[0]=parseInt(G[0],10);if(G[0]!=-1&&G[1][G[0]+1]){if(a.isFunction(c.onclickPgButtons)){c.onclickPgButtons("next",a("#"+A),G[1][G[0]])}n(G[1][G[0]+1],w);a(w).jqGrid("setSelection",G[1][G[0]+1]);if(a.isFunction(c.afterclickPgButtons)){c.afterclickPgButtons("next",a("#"+A),G[1][G[0]+1])}p(G[0]+1,G[1].length-1)}k();return false});a("#pData","#"+t+"_2").click(function(G){a("#FormError","#"+t).hide();var F=h();if(F[0]!=-1&&F[1][F[0]-1]){if(a.isFunction(c.onclickPgButtons)){c.onclickPgButtons("prev",a("#"+A),F[1][F[0]])}n(F[1][F[0]-1],w);a(w).jqGrid("setSelection",F[1][F[0]-1]);if(a.isFunction(c.afterclickPgButtons)){c.afterclickPgButtons("prev",a("#"+A),F[1][F[0]-1])}p(F[0]-1,F[1].length-1)}k();return false})}var q=h();p(q[0],q[1].length-1)})},delGridRow:function(b,d){d=a.extend({top:0,left:0,width:240,height:"auto",dataheight:"auto",modal:false,overlay:10,drag:true,resize:true,url:"",mtype:"POST",reloadAfterSubmit:true,beforeShowForm:null,beforeInitData:null,afterShowForm:null,beforeSubmit:null,onclickSubmit:null,afterSubmit:null,jqModal:true,closeOnEscape:false,delData:{},delicon:[],cancelicon:[],onClose:null,ajaxDelOptions:{},processing:false,serializeDelData:null,useDataProxy:false},a.jgrid.del,d||{});var c=d;return this.each(function(){var p=this;if(!p.grid){return}if(!b){return}var q=a.isFunction(d.beforeShowForm),g=a.isFunction(d.afterShowForm),t=a.isFunction(d.beforeInitData)?d.beforeInitData:false,e=p.p.id,f={},l=true,m="DelTbl_"+e,s,r,o,k,h={themodal:"delmod"+e,modalhead:"delhd"+e,modalcontent:"delcnt"+e,scrollelm:m};if(jQuery.isArray(b)){b=b.join()}if(a("#"+h.themodal).html()!==null){if(t){l=t(a("#"+m));if(typeof(l)=="undefined"){l=true}}if(l===false){return}a("#DelData>td","#"+m).text(b);a("#DelError","#"+m).hide();if(c.processing===true){c.processing=false;a("#dData","#"+m).removeClass("ui-state-active")}if(q){d.beforeShowForm(a("#"+m))}a.jgrid.viewModal("#"+h.themodal,{gbox:"#gbox_"+e,jqm:d.jqModal,jqM:false,overlay:d.overlay,modal:d.modal});if(g){d.afterShowForm(a("#"+m))}}else{var u=isNaN(d.dataheight)?d.dataheight:d.dataheight+"px";var n="<div id='"+m+"' class='formdata' style='width:100%;overflow:auto;position:relative;height:"+u+";'>";n+="<table class='DelTable'><tbody>";n+="<tr id='DelError' style='display:none'><td class='ui-state-error'></td></tr>";n+="<tr id='DelData' style='display:none'><td >"+b+"</td></tr>";n+='<tr><td class="delmsg" style="white-space:pre;">'+d.msg+"</td></tr><tr><td >&#160;</td></tr>";n+="</tbody></table></div>";var j="<a href='javascript:void(0)' id='dData' class='fm-button ui-state-default ui-corner-all'>"+d.bSubmit+"</a>",v="<a href='javascript:void(0)' id='eData' class='fm-button ui-state-default ui-corner-all'>"+d.bCancel+"</a>";n+="<table cellspacing='0' cellpadding='0' border='0' class='EditTable' id='"+m+"_2'><tbody><tr><td><hr class='ui-widget-content' style='margin:1px'/></td></tr></tr><tr><td class='DelButton EditButton'>"+j+"&#160;"+v+"</td></tr></tbody></table>";d.gbox="#gbox_"+e;a.jgrid.createModal(h,n,d,"#gview_"+p.p.id,a("#gview_"+p.p.id)[0]);if(t){l=t(a("#"+m));if(typeof(l)=="undefined"){l=true}}if(l===false){return}a(".fm-button","#"+m+"_2").hover(function(){a(this).addClass("ui-state-hover")},function(){a(this).removeClass("ui-state-hover")});d.delicon=a.extend([true,"left","ui-icon-scissors"],d.delicon);d.cancelicon=a.extend([true,"left","ui-icon-cancel"],d.cancelicon);if(d.delicon[0]===true){a("#dData","#"+m+"_2").addClass(d.delicon[1]=="right"?"fm-button-icon-right":"fm-button-icon-left").append("<span class='ui-icon "+d.delicon[2]+"'></span>")}if(d.cancelicon[0]===true){a("#eData","#"+m+"_2").addClass(d.cancelicon[1]=="right"?"fm-button-icon-right":"fm-button-icon-left").append("<span class='ui-icon "+d.cancelicon[2]+"'></span>")}a("#dData","#"+m+"_2").click(function(z){var x=[true,""];f={};var y=a("#DelData>td","#"+m).text();if(a.isFunction(d.onclickSubmit)){f=d.onclickSubmit(c,y)||{}}if(a.isFunction(d.beforeSubmit)){x=d.beforeSubmit(y)}if(x[0]&&!c.processing){c.processing=true;a(this).addClass("ui-state-active");o=p.p.prmNames;s=a.extend({},c.delData,f);k=o.oper;s[k]=o.deloper;r=o.id;s[r]=y;var w=a.extend({url:c.url?c.url:a(p).jqGrid("getGridParam","editurl"),type:d.mtype,data:a.isFunction(d.serializeDelData)?d.serializeDelData(s):s,complete:function(D,B){if(B!="success"){x[0]=false;if(a.isFunction(c.errorTextFormat)){x[1]=c.errorTextFormat(D)}else{x[1]=B+" Status: '"+D.statusText+"'. Error code: "+D.status}}else{if(a.isFunction(c.afterSubmit)){x=c.afterSubmit(D,s)}}if(x[0]===false){a("#DelError>td","#"+m).html(x[1]);a("#DelError","#"+m).show()}else{if(c.reloadAfterSubmit&&p.p.datatype!="local"){a(p).trigger("reloadGrid")}else{var A=[];A=y.split(",");if(p.p.treeGrid===true){try{a(p).jqGrid("delTreeNode",A[0])}catch(E){}}else{for(var C=0;C<A.length;C++){a(p).jqGrid("delRowData",A[C])}}p.p.selrow=null;p.p.selarrrow=[]}if(a.isFunction(c.afterComplete)){setTimeout(function(){c.afterComplete(D,y)},500)}}c.processing=false;a("#dData","#"+m+"_2").removeClass("ui-state-active");if(x[0]){a.jgrid.hideModal("#"+h.themodal,{gb:"#gbox_"+e,jqm:d.jqModal,onClose:c.onClose})}}},a.jgrid.ajaxOptions,d.ajaxDelOptions);if(!w.url&&!c.useDataProxy){if(a.isFunction(p.p.dataProxy)){c.useDataProxy=true}else{x[0]=false;x[1]+=" "+a.jgrid.errors.nourl}}if(x[0]){if(c.useDataProxy){p.p.dataProxy.call(p,w,"del_"+p.p.id)}else{a.ajax(w)}}}if(x[0]===false){a("#DelError>td","#"+m).html(x[1]);a("#DelError","#"+m).show()}return false});a("#eData","#"+m+"_2").click(function(w){a.jgrid.hideModal("#"+h.themodal,{gb:"#gbox_"+e,jqm:d.jqModal,onClose:c.onClose});return false});if(q){d.beforeShowForm(a("#"+m))}a.jgrid.viewModal("#"+h.themodal,{gbox:"#gbox_"+e,jqm:d.jqModal,overlay:d.overlay,modal:d.modal});if(g){d.afterShowForm(a("#"+m))}}if(d.closeOnEscape===true){setTimeout(function(){a(".ui-jqdialog-titlebar-close","#"+h.modalhead).focus()},0)}})},navGrid:function(e,g,d,f,c,b,h){g=a.extend({edit:true,editicon:"ui-icon-pencil",add:true,addicon:"ui-icon-plus",del:true,delicon:"ui-icon-trash",search:true,searchicon:"ui-icon-search",refresh:true,refreshicon:"ui-icon-refresh",refreshstate:"firstpage",view:false,viewicon:"ui-icon-document",position:"left",closeOnEscape:true,beforeRefresh:null,afterRefresh:null,cloneToTop:false},a.jgrid.nav,g||{});return this.each(function(){if(this.nav){return}var j={themodal:"alertmod",modalhead:"alerthd",modalcontent:"alertcnt"},n=this,m,v,p,k;if(!n.grid||typeof e!="string"){return}if(a("#"+j.themodal).html()===null){if(typeof window.innerWidth!="undefined"){m=window.innerWidth;v=window.innerHeight}else{if(typeof document.documentElement!="undefined"&&typeof document.documentElement.clientWidth!="undefined"&&document.documentElement.clientWidth!==0){m=document.documentElement.clientWidth;v=document.documentElement.clientHeight}else{m=1024;v=768}}a.jgrid.createModal(j,"<div>"+g.alerttext+"</div><span tabindex='0'><span tabindex='-1' id='jqg_alrt'></span></span>",{gbox:"#gbox_"+n.p.id,jqModal:true,drag:true,resize:true,caption:g.alertcap,top:v/2-25,left:m/2-100,width:200,height:"auto",closeOnEscape:g.closeOnEscape},"","",true)}var q=1;if(g.cloneToTop&&n.p.toppager){q=2}for(var o=0;o<q;o++){var r,t=a("<table cellspacing='0' cellpadding='0' border='0' class='ui-pg-table navtable' style='float:left;table-layout:auto;'><tbody><tr></tr></tbody></table>"),u="<td class='ui-pg-button ui-state-disabled' style='width:4px;'><span class='ui-separator'></span></td>",l,s;if(o===0){l=e;s=n.p.id;if(l==n.p.toppager){s+="_top";q=1}}else{l=n.p.toppager;s=n.p.id+"_top"}if(n.p.direction=="rtl"){a(t).attr("dir","rtl").css("float","right")}if(g.add){f=f||{};r=a("<td class='ui-pg-button ui-corner-all'></td>");a(r).append("<div class='ui-pg-div'><span class='ui-icon "+g.addicon+"'></span>"+g.addtext+"</div>");a("tr",t).append(r);a(r,t).attr({title:g.addtitle||"",id:f.id||"add_"+s}).click(function(){if(!a(this).hasClass("ui-state-disabled")){if(a.isFunction(g.addfunc)){g.addfunc()}else{a(n).jqGrid("editGridRow","new",f)}}return false}).hover(function(){if(!a(this).hasClass("ui-state-disabled")){a(this).addClass("ui-state-hover")}},function(){a(this).removeClass("ui-state-hover")});r=null}if(g.edit){r=a("<td class='ui-pg-button ui-corner-all'></td>");d=d||{};a(r).append("<div class='ui-pg-div'><span class='ui-icon "+g.editicon+"'></span>"+g.edittext+"</div>");a("tr",t).append(r);a(r,t).attr({title:g.edittitle||"",id:d.id||"edit_"+s}).click(function(){if(!a(this).hasClass("ui-state-disabled")){var w=n.p.selrow;if(w){if(a.isFunction(g.editfunc)){g.editfunc(w)}else{a(n).jqGrid("editGridRow",w,d)}}else{a.jgrid.viewModal("#"+j.themodal,{gbox:"#gbox_"+n.p.id,jqm:true});a("#jqg_alrt").focus()}}return false}).hover(function(){if(!a(this).hasClass("ui-state-disabled")){a(this).addClass("ui-state-hover")}},function(){a(this).removeClass("ui-state-hover")});r=null}if(g.view){r=a("<td class='ui-pg-button ui-corner-all'></td>");h=h||{};a(r).append("<div class='ui-pg-div'><span class='ui-icon "+g.viewicon+"'></span>"+g.viewtext+"</div>");a("tr",t).append(r);a(r,t).attr({title:g.viewtitle||"",id:h.id||"view_"+s}).click(function(){if(!a(this).hasClass("ui-state-disabled")){var w=n.p.selrow;if(w){if(a.isFunction(g.viewfunc)){g.viewfunc(w)}else{a(n).jqGrid("viewGridRow",w,h)}}else{a.jgrid.viewModal("#"+j.themodal,{gbox:"#gbox_"+n.p.id,jqm:true});a("#jqg_alrt").focus()}}return false}).hover(function(){if(!a(this).hasClass("ui-state-disabled")){a(this).addClass("ui-state-hover")}},function(){a(this).removeClass("ui-state-hover")});r=null}if(g.del){r=a("<td class='ui-pg-button ui-corner-all'></td>");c=c||{};a(r).append("<div class='ui-pg-div'><span class='ui-icon "+g.delicon+"'></span>"+g.deltext+"</div>");a("tr",t).append(r);a(r,t).attr({title:g.deltitle||"",id:c.id||"del_"+s}).click(function(){if(!a(this).hasClass("ui-state-disabled")){var w;if(n.p.multiselect){w=n.p.selarrrow;if(w.length===0){w=null}}else{w=n.p.selrow}if(w){if("function"==typeof g.delfunc){g.delfunc(w)}else{a(n).jqGrid("delGridRow",w,c)}}else{a.jgrid.viewModal("#"+j.themodal,{gbox:"#gbox_"+n.p.id,jqm:true});a("#jqg_alrt").focus()}}return false}).hover(function(){if(!a(this).hasClass("ui-state-disabled")){a(this).addClass("ui-state-hover")}},function(){a(this).removeClass("ui-state-hover")});r=null}if(g.add||g.edit||g.del||g.view){a("tr",t).append(u)}if(g.search){r=a("<td class='ui-pg-button ui-corner-all'></td>");b=b||{};a(r).append("<div class='ui-pg-div'><span class='ui-icon "+g.searchicon+"'></span>"+g.searchtext+"</div>");a("tr",t).append(r);a(r,t).attr({title:g.searchtitle||"",id:b.id||"search_"+s}).click(function(){if(!a(this).hasClass("ui-state-disabled")){a(n).jqGrid("searchGrid",b)}return false}).hover(function(){if(!a(this).hasClass("ui-state-disabled")){a(this).addClass("ui-state-hover")}},function(){a(this).removeClass("ui-state-hover")});if(b.showOnLoad&&b.showOnLoad===true){a(r,t).click()}r=null}if(g.refresh){r=a("<td class='ui-pg-button ui-corner-all'></td>");a(r).append("<div class='ui-pg-div'><span class='ui-icon "+g.refreshicon+"'></span>"+g.refreshtext+"</div>");a("tr",t).append(r);a(r,t).attr({title:g.refreshtitle||"",id:"refresh_"+s}).click(function(){if(!a(this).hasClass("ui-state-disabled")){if(a.isFunction(g.beforeRefresh)){g.beforeRefresh()}n.p.search=false;try{var w=n.p.id;n.p.postData.filters="";a("#fbox_"+w).jqFilter("resetFilter");if(a.isFunction(n.clearToolbar)){n.clearToolbar(false)}}catch(x){}switch(g.refreshstate){case"firstpage":a(n).trigger("reloadGrid",[{page:1}]);break;case"current":a(n).trigger("reloadGrid",[{current:true}]);break}if(a.isFunction(g.afterRefresh)){g.afterRefresh()}}return false}).hover(function(){if(!a(this).hasClass("ui-state-disabled")){a(this).addClass("ui-state-hover")}},function(){a(this).removeClass("ui-state-hover")});r=null}k=a(".ui-jqgrid").css("font-size")||"11px";a("body").append("<div id='testpg2' class='ui-jqgrid ui-widget ui-widget-content' style='font-size:"+k+";visibility:hidden;' ></div>");p=a(t).clone().appendTo("#testpg2").width();a("#testpg2").remove();a(l+"_"+g.position,l).append(t);if(n.p._nvtd){if(p>n.p._nvtd[0]){a(l+"_"+g.position,l).width(p);n.p._nvtd[0]=p}n.p._nvtd[1]=p}k=null;p=null;t=null;this.nav=true}})},navButtonAdd:function(b,c){c=a.extend({caption:"newButton",title:"",buttonicon:"ui-icon-newwin",onClickButton:null,position:"last",cursor:"pointer"},c||{});return this.each(function(){if(!this.grid){return}if(b.indexOf("#")!==0){b="#"+b}var d=a(".navtable",b)[0],f=this;if(d){if(c.id&&a("#"+c.id,d).html()!==null){return}var e=a("<td></td>");if(c.buttonicon.toString().toUpperCase()=="NONE"){a(e).addClass("ui-pg-button ui-corner-all").append("<div class='ui-pg-div'>"+c.caption+"</div>")}else{a(e).addClass("ui-pg-button ui-corner-all").append("<div class='ui-pg-div'><span class='ui-icon "+c.buttonicon+"'></span>"+c.caption+"</div>")}if(c.id){a(e).attr("id",c.id)}if(c.position=="first"){if(d.rows[0].cells.length===0){a("tr",d).append(e)}else{a("tr td:eq(0)",d).before(e)}}else{a("tr",d).append(e)}a(e,d).attr("title",c.title||"").click(function(g){if(!a(this).hasClass("ui-state-disabled")){if(a.isFunction(c.onClickButton)){c.onClickButton.call(f,g)}}return false}).hover(function(){if(!a(this).hasClass("ui-state-disabled")){a(this).addClass("ui-state-hover")}},function(){a(this).removeClass("ui-state-hover")})}})},navSeparatorAdd:function(b,c){c=a.extend({sepclass:"ui-separator",sepcontent:""},c||{});return this.each(function(){if(!this.grid){return}if(b.indexOf("#")!==0){b="#"+b}var e=a(".navtable",b)[0];if(e){var d="<td class='ui-pg-button ui-state-disabled' style='width:4px;'><span class='"+c.sepclass+"'></span>"+c.sepcontent+"</td>";a("tr",e).append(d)}})},GridToForm:function(b,c){return this.each(function(){var f=this;if(!f.grid){return}var e=a(f).jqGrid("getRowData",b);if(e){for(var d in e){if(a("[name="+a.jgrid.jqID(d)+"]",c).is("input:radio")||a("[name="+a.jgrid.jqID(d)+"]",c).is("input:checkbox")){a("[name="+a.jgrid.jqID(d)+"]",c).each(function(){if(a(this).val()==e[d]){a(this).attr("checked","checked")}else{a(this).attr("checked","")}})}else{a("[name="+a.jgrid.jqID(d)+"]",c).val(e[d])}}}})},FormToGrid:function(c,d,e,b){return this.each(function(){var h=this;if(!h.grid){return}if(!e){e="set"}if(!b){b="first"}var f=a(d).serializeArray();var g={};a.each(f,function(j,k){g[k.name]=k.value});if(e=="add"){a(h).jqGrid("addRowData",c,g,b)}else{if(e=="set"){a(h).jqGrid("setRowData",c,g)}}})}})})(jQuery);